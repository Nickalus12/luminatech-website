---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Container from '../../components/ui/Container.astro';
import Badge from '../../components/ui/Badge.astro';

const allStudies = await getCollection('caseStudies');
const studies = allStudies.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<BaseLayout
  title="Case Studies"
  description="Real results from real distributors. See how Prophet 21 customization, reporting, and automation have transformed operations for wholesale distribution companies."
>
  <section class="py-12 md:py-20">
    <Container>
      <header class="mb-12 max-w-3xl scroll-reveal">
        <h1 class="text-[length:var(--font-size-h2)] font-bold mb-3">Client Success Stories</h1>
        <p class="text-text-secondary text-[length:var(--font-size-body-lg)] max-w-2xl">
          Real results from real distributors. See how targeted P21 customization and automation deliver measurable ROI.
        </p>
      </header>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {studies.map((study, i) => {
          const metricEntries = Object.entries(study.data.metrics).slice(0, 3);
          return (
            <a
              href={`/case-studies/${study.data.slug}/`}
              class="group block bg-bg-surface-1 rounded-xl border border-border p-6 md:p-8 hover:border-accent-primary hover:-translate-y-1 transition-all duration-normal shadow-card hover:shadow-card-hover no-underline scroll-reveal"
              style={`animation-delay: ${i * 100}ms;`}
            >
              <div class="flex flex-wrap items-center gap-2 mb-4">
                <Badge variant="primary">{study.data.industry}</Badge>
                {study.data.featured && (
                  <Badge variant="success">Featured</Badge>
                )}
              </div>

              <h2 class="text-[length:var(--font-size-h4)] font-semibold leading-snug mb-3 text-text-primary group-hover:text-accent-primary transition-colors duration-fast">
                {study.data.title}
              </h2>

              <p class="text-text-secondary text-sm leading-relaxed mb-6 line-clamp-3">
                {study.data.summary}
              </p>

              <div class="grid grid-cols-3 gap-4 mb-6 p-4 rounded-lg bg-bg-surface-2/50 border border-border/50">
                {metricEntries.map(([, metric]) => (
                  <div class="text-center">
                    <div class="text-accent-primary font-bold text-lg md:text-xl">{metric.improvement}</div>
                    <div class="text-text-tertiary text-xs mt-1">{metric.before} &rarr; {metric.after}</div>
                  </div>
                ))}
              </div>

              <div class="flex items-center justify-between">
                <div class="flex flex-wrap gap-1.5">
                  {study.data.services.map((service) => (
                    <span class="text-xs px-2 py-0.5 rounded bg-bg-surface-2 text-text-tertiary">
                      {service}
                    </span>
                  ))}
                </div>
                <span class="text-sm text-accent-primary font-medium group-hover:translate-x-1 transition-transform duration-fast inline-flex items-center gap-1 shrink-0">
                  Read Case Study
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M5 12h14" /><path d="m12 5 7 7-7 7" />
                  </svg>
                </span>
              </div>
            </a>
          );
        })}
      </div>
    </Container>
  </section>
</BaseLayout>

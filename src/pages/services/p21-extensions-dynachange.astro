---
import ServiceDetailLayout from '@layouts/ServiceDetailLayout.astro';
import Section from '@components/ui/Section.astro';
import Container from '@components/ui/Container.astro';
import Card from '@components/ui/Card.astro';
import Badge from '@components/ui/Badge.astro';
import GlowText from '@components/ui/GlowText.astro';
import Button from '@components/ui/Button.astro';
import TerminalCode from '@components/ui/TerminalCode';
---

<ServiceDetailLayout
  title="P21 Extensions & DynaChange"
  description="Custom P21 business rules and DynaChange extensions that automate workflows, enforce validation, and integrate with external systems — without modifying core P21 code."
  badge="DynaChange Development"
  headline="Custom P21 Business Rules That Actually Work in Production"
  subheadline="Turn P21 limitations into competitive advantages. We build DynaChange business rules that automate workflows, enforce validation, and integrate with external systems — without modifying core P21 code."
  heroMetrics={[
    { value: "C#", label: ".NET Framework" },
    { value: "SDK", label: "P21 Extensions v4.6+" },
    { value: "Zero", label: "Core Code Changes" },
    { value: "30-Day", label: "Warranty Included" },
  ]}
  ctaLabel="Request Extension Development Quote"
  ctaHref="/contact"
>

  <!-- DEVELOPMENT APPROACH -->
  <Section background="base" padding="md">
    <Container>
      <div class="text-center mb-12 scroll-reveal">
        <h2 class="text-[length:var(--font-size-h2)] font-bold text-text-primary leading-tight mb-4">
          Our Development Approach
        </h2>
        <p class="text-[length:var(--font-size-body-lg)] text-text-secondary max-w-2xl mx-auto">
          Built on proven patterns refined across multiple P21 environments, with safety and reliability as the foundation.
        </p>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        {[
          { icon: "code", title: "C# .NET Framework", desc: "Built against the P21 Extensions SDK (v4.6.1/4.8) using Visual Studio for full IntelliSense support and debugging." },
          { icon: "shield", title: "Fail-Safe Patterns", desc: "Rules never block legitimate operations due to errors. Try-catch wrappers ensure business continuity even if a rule encounters unexpected data." },
          { icon: "database", title: "Database Integration", desc: "Custom tables for configuration and audit trails. Business users can adjust rule parameters without recompilation." },
          { icon: "layers", title: "Multi-Version Support", desc: "Desktop and Web UI compatibility from day one. Field alias fallback patterns handle P21 version differences gracefully." },
        ].map((item, i) => (
          <div class="text-center p-6 rounded-xl bg-bg-surface-1 border border-border/50 scroll-reveal" style={`animation-delay: ${i * 100}ms;`}>
            <div class="w-12 h-12 mx-auto mb-4 rounded-lg bg-accent-primary/10 flex items-center justify-center">
              {item.icon === "code" && <svg class="w-6 h-6 text-accent-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="16 18 22 12 16 6" /><polyline points="8 6 2 12 8 18" /></svg>}
              {item.icon === "shield" && <svg class="w-6 h-6 text-accent-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" /></svg>}
              {item.icon === "database" && <svg class="w-6 h-6 text-accent-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><ellipse cx="12" cy="5" rx="9" ry="3" /><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3" /><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5" /></svg>}
              {item.icon === "layers" && <svg class="w-6 h-6 text-accent-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polygon points="12 2 2 7 12 12 22 7 12 2" /><polyline points="2 17 12 22 22 17" /><polyline points="2 12 12 17 22 12" /></svg>}
            </div>
            <h3 class="text-base font-semibold text-text-primary mb-2">{item.title}</h3>
            <p class="text-sm text-text-secondary leading-relaxed">{item.desc}</p>
          </div>
        ))}
      </div>
    </Container>
  </Section>

  <!-- RULE TYPES TABLE -->
  <Section background="surface-1" padding="md">
    <Container>
      <div class="text-center mb-12 scroll-reveal">
        <h2 class="text-[length:var(--font-size-h2)] font-bold text-text-primary leading-tight mb-4">
          Types of Rules We Build
        </h2>
        <p class="text-[length:var(--font-size-body-lg)] text-text-secondary max-w-2xl mx-auto">
          From simple field converters to complex multi-step workflows, we cover the full DynaChange rule spectrum.
        </p>
      </div>

      <div class="max-w-4xl mx-auto scroll-reveal" style="animation-delay: 100ms;">
        <div class="overflow-x-auto rounded-xl border border-border">
          <table class="w-full text-left">
            <thead>
              <tr class="bg-bg-surface-2">
                <th class="px-6 py-4 text-sm font-semibold text-text-primary">Rule Type</th>
                <th class="px-6 py-4 text-sm font-semibold text-text-primary">Use Cases</th>
                <th class="px-6 py-4 text-sm font-semibold text-text-primary whitespace-nowrap">Typical Timeline</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-border/50">
              <tr class="bg-bg-surface-1 hover:bg-bg-surface-2/50 transition-colors">
                <td class="px-6 py-4">
                  <span class="font-semibold text-text-primary">Validators</span>
                </td>
                <td class="px-6 py-4 text-sm text-text-secondary">Block invalid saves, enforce business constraints, prevent bad data entry</td>
                <td class="px-6 py-4 text-sm text-accent-primary font-mono whitespace-nowrap">1-2 weeks</td>
              </tr>
              <tr class="bg-bg-surface-1 hover:bg-bg-surface-2/50 transition-colors">
                <td class="px-6 py-4">
                  <span class="font-semibold text-text-primary">Converters</span>
                </td>
                <td class="px-6 py-4 text-sm text-text-secondary">Auto-populate fields, transform data on save, enforce formatting rules</td>
                <td class="px-6 py-4 text-sm text-accent-primary font-mono whitespace-nowrap">1 week</td>
              </tr>
              <tr class="bg-bg-surface-1 hover:bg-bg-surface-2/50 transition-colors">
                <td class="px-6 py-4">
                  <span class="font-semibold text-text-primary">On Event</span>
                </td>
                <td class="px-6 py-4 text-sm text-text-secondary">Intercept document actions, trigger workflows, automate multi-step processes</td>
                <td class="px-6 py-4 text-sm text-accent-primary font-mono whitespace-nowrap">2-3 weeks</td>
              </tr>
              <tr class="bg-bg-surface-1 hover:bg-bg-surface-2/50 transition-colors">
                <td class="px-6 py-4">
                  <span class="font-semibold text-text-primary">On Demand</span>
                </td>
                <td class="px-6 py-4 text-sm text-text-secondary">Button-triggered business processes, one-click operations from any P21 screen</td>
                <td class="px-6 py-4 text-sm text-accent-primary font-mono whitespace-nowrap">3-4 weeks</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </Container>
  </Section>

  <!-- TECHNICAL DEPTH -->
  <Section background="base" padding="md">
    <Container>
      <div class="text-center mb-12 scroll-reveal">
        <Badge variant="primary" class="mb-5">Technical Depth</Badge>
        <h2 class="text-[length:var(--font-size-h2)] font-bold text-text-primary leading-tight mb-4">
          Why Our Extensions Stand Out
        </h2>
        <p class="text-[length:var(--font-size-body-lg)] text-text-secondary max-w-2xl mx-auto">
          Architecture patterns refined through production deployments, not just theory.
        </p>
      </div>

      <!-- Key architecture patterns -->
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-10">
        {[
          { title: "Hybrid API + SQL", desc: "Primary path uses the Transaction API for full business logic. SQL fallback ensures reliability during maintenance windows." },
          { title: "Config-Driven Logic", desc: "Custom config tables let business users adjust thresholds and behavior without recompiling the DLL." },
          { title: "Comprehensive Auditing", desc: "Every automated action is logged with full visibility into what changed, when, and why." },
        ].map((item, i) => (
          <div class="p-5 rounded-xl bg-bg-surface-1 border border-border/50 scroll-reveal" style={`animation-delay: ${i * 100}ms;`}>
            <h3 class="text-base font-semibold text-text-primary mb-2">{item.title}</h3>
            <p class="text-sm text-text-secondary leading-relaxed">{item.desc}</p>
          </div>
        ))}
      </div>

      <!-- Animated terminal code -->
      <div class="max-w-3xl mx-auto scroll-reveal" style="animation-delay: 200ms;">
        <TerminalCode client:visible />
      </div>

      <!-- Code Quality Callouts -->
      <div class="mt-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 scroll-reveal" style="animation-delay: 300ms;">
        {[
          "Field alias fallback for version compatibility",
          "NOLOCK on all read queries for performance",
          "User-friendly error messages (no jargon)",
          "Remote diagnostics via logging API",
        ].map((item) => (
          <div class="flex items-start gap-3 p-4 rounded-lg bg-bg-surface-1/50 border border-border/50">
            <svg class="w-4 h-4 text-accent-success shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M20 6 9 17l-5-5" /></svg>
            <span class="text-sm text-text-secondary">{item}</span>
          </div>
        ))}
      </div>
    </Container>
  </Section>

  <!-- PRICING & DELIVERABLES -->
  <Section background="base" padding="lg">
    <Container>
      <div class="text-center mb-12 scroll-reveal">
        <Badge variant="success" class="mb-5">Transparent Pricing</Badge>
        <h2 class="text-[length:var(--font-size-h2)] font-bold text-text-primary leading-tight mb-4">
          Pricing & Deliverables
        </h2>
        <p class="text-[length:var(--font-size-body-lg)] text-text-secondary max-w-2xl mx-auto">
          Fixed pricing based on scope. No hourly surprises, no ambiguous deliverables.
        </p>
      </div>

      <!-- Pricing Tiers -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto mb-12">
        <Card padding="lg" class="scroll-reveal text-center">
          <h3 class="text-base font-semibold text-text-primary mb-2">Simple Rule</h3>
          <p class="text-xs text-text-tertiary mb-4">Converter / Validator</p>
          <div class="flex items-baseline justify-center gap-1 mb-4">
            <span class="text-3xl font-mono font-bold text-accent-primary">$1,500</span>
            <span class="text-text-tertiary">-</span>
            <span class="text-3xl font-mono font-bold text-accent-primary">$3,000</span>
          </div>
          <p class="text-sm text-text-secondary">Field validation, auto-population, data transformation rules with straightforward logic.</p>
        </Card>

        <Card padding="lg" glow class="scroll-reveal text-center" style="animation-delay: 100ms;">
          <Badge variant="primary" class="mb-3">Most Common</Badge>
          <h3 class="text-base font-semibold text-text-primary mb-2">Complex Rule</h3>
          <p class="text-xs text-text-tertiary mb-4">On Event / API Integration</p>
          <div class="flex items-baseline justify-center gap-1 mb-4">
            <span class="text-3xl font-mono font-bold text-accent-primary">$4,000</span>
            <span class="text-text-tertiary">-</span>
            <span class="text-3xl font-mono font-bold text-accent-primary">$8,000</span>
          </div>
          <p class="text-sm text-text-secondary">Document interception, Transaction API integration, multi-step workflows with error handling.</p>
        </Card>

        <Card padding="lg" class="scroll-reveal text-center" style="animation-delay: 200ms;">
          <h3 class="text-base font-semibold text-text-primary mb-2">Multi-Rule Project</h3>
          <p class="text-xs text-text-tertiary mb-4">Custom Scope</p>
          <div class="flex items-baseline justify-center gap-1 mb-4">
            <span class="text-3xl font-mono font-bold text-accent-primary">Custom</span>
          </div>
          <p class="text-sm text-text-secondary">Multiple interconnected rules, full workflow automation suites. Quote based on discovery.</p>
        </Card>
      </div>

      <!-- Timeline -->
      <div class="max-w-3xl mx-auto scroll-reveal" style="animation-delay: 300ms;">
        <h3 class="text-lg font-semibold text-text-primary mb-6 text-center">Typical Engagement Timeline</h3>
        <div class="space-y-4">
          {[
            { phase: "Discovery", duration: "1-2 days", desc: "Requirements gathering, P21 environment review, technical spec" },
            { phase: "Development", duration: "1-4 weeks", desc: "Rule coding, PLAY environment testing, validation" },
            { phase: "Deployment", duration: "1 day", desc: "Production deployment, user training, go-live support" },
            { phase: "Warranty", duration: "30 days", desc: "Post-deployment support, bug fixes, minor adjustments" },
          ].map((step, i) => (
            <div class="flex items-start gap-4">
              <div class="shrink-0 w-24 text-right">
                <span class="text-sm font-mono font-bold text-accent-primary">{step.duration}</span>
              </div>
              <div class="grow border-l-2 border-accent-primary/30 pl-4 pb-2">
                <h4 class="font-semibold text-text-primary text-sm">{step.phase}</h4>
                <p class="text-sm text-text-secondary mt-1">{step.desc}</p>
              </div>
            </div>
          ))}
        </div>
      </div>

      <!-- What You Get -->
      <div class="max-w-3xl mx-auto mt-12 scroll-reveal" style="animation-delay: 400ms;">
        <Card hover={false} padding="lg">
          <h3 class="text-lg font-semibold text-text-primary mb-4">What You Get</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            {[
              "Compiled .DLL file ready for deployment",
              "Installation documentation",
              "P21 configuration guide (Field Selector setup)",
              "Source code (C# .csproj)",
              "SQL scripts for custom tables/stored procedures",
              "30-day warranty on defects",
            ].map((item) => (
              <div class="flex items-start gap-3">
                <svg class="w-4 h-4 text-accent-success shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M20 6 9 17l-5-5" /></svg>
                <span class="text-sm text-text-secondary">{item}</span>
              </div>
            ))}
          </div>
        </Card>
      </div>

      <!-- CTA -->
      <div class="text-center mt-12 scroll-reveal" style="animation-delay: 500ms;">
        <Button href="/contact" variant="primary" size="lg" arrow glow>
          Request Extension Development Quote
        </Button>
      </div>
    </Container>
  </Section>

</ServiceDetailLayout>

---
import BaseLayout from '../layouts/BaseLayout.astro';
import Section from '../components/ui/Section.astro';
import Container from '../components/ui/Container.astro';
import Card from '../components/ui/Card.astro';
import Button from '../components/ui/Button.astro';
import Badge from '../components/ui/Badge.astro';
import InteractiveROICalculator from '../components/ui/InteractiveROICalculator';
import ServiceCardGrid from '../components/ui/ServiceCardGrid';
import ServiceSelectorQuiz from '../components/ui/ServiceSelectorQuiz';
import GlowText from '../components/ui/GlowText.astro';
import TextReveal from '../components/ui/TextReveal';
import ScrollCounter from '../components/ui/ScrollCounter';
import { services, brand } from '../content/copy';

const description = "Comprehensive Prophet 21 consulting services: advisory, custom development, cloud migration, reporting, integrations, and managed support for wholesale distributors.";

// ROI Models for each service
const roiModels = {
  extensions: {
    assumptions: [
      { label: "Avg hourly rate for manual work", value: "$35/hr" },
      { label: "Orders/month requiring intervention", value: "200" },
      { label: "Time saved per order", value: "15 min" },
    ],
    calculation: "200 orders * 15 min * $35/hr / 60 = $1,750/mo savings",
    breakeven: "4.3 months",
    yearOneROI: "365%",
    competitiveEdge: "Epicor's standard consulting: $250/hr (75% premium). We deliver faster at lower rates.",
  },
  integrations: {
    assumptions: [
      { label: "Manual data entry time", value: "20 hrs/wk" },
      { label: "Data entry errors/month", value: "12" },
      { label: "Error resolution time", value: "2 hrs each" },
    ],
    calculation: "20 hrs/wk * $35/hr * 4.3 wks + 12 errors * 2 hrs * $35/hr = $3,850/mo savings",
    breakeven: "3.9 months",
    yearOneROI: "210%",
    competitiveEdge: "Off-the-shelf iPaaS: $1,200-$3,000/mo ongoing. Custom N8N: one-time cost, self-hosted.",
  },
  database: {
    assumptions: [
      { label: "Staff waiting on slow reports", value: "5 people" },
      { label: "Report run time before", value: "30 sec/query" },
      { label: "Report run time after", value: "2 sec/query" },
    ],
    calculation: "5 staff * 50 queries/day * 28 sec saved * 22 days * $35/hr / 3600 = $1,496/mo",
    breakeven: "3.3 months",
    yearOneROI: "259%",
    competitiveEdge: "Most consultants recommend hardware upgrades ($10K+). We optimize queries for 90% less cost.",
  },
  warehouse: {
    assumptions: [
      { label: "Picker travel time reduction", value: "25%" },
      { label: "Current pick labor cost", value: "$8,400/mo" },
      { label: "Shipping errors eliminated", value: "8/mo @ $150 ea" },
    ],
    calculation: "$8,400 * 25% + 8 * $150 = $3,300/mo savings",
    breakeven: "2.4 months",
    yearOneROI: "398%",
    competitiveEdge: "Full WMS implementations: $50K-$250K. Our automations: 95% less investment, faster ROI.",
  },
  portals: {
    assumptions: [
      { label: "CSR pricing lookup time", value: "4 min/quote" },
      { label: "Quotes per day", value: "30" },
      { label: "CSR hourly rate", value: "$28/hr" },
    ],
    calculation: "30 quotes * 4 min * $28/hr / 60 * 22 days = $1,232/mo saved",
    breakeven: "8.1 months",
    yearOneROI: "48%",
    competitiveEdge: "Custom portal vs. forcing customers into clunky P21 WebPOS. Better UX = competitive advantage.",
  },
  support: {
    assumptions: [
      { label: "Emergency support calls/year", value: "3" },
      { label: "Emergency rate (other firms)", value: "$300/hr" },
      { label: "Hours per emergency", value: "4 hrs" },
    ],
    calculation: "3 emergencies * 4 hrs * $300/hr = $3,600/yr avoided",
    breakeven: "Immediate (vs. emergency rates)",
    yearOneROI: "227% (Standard tier)",
    competitiveEdge: "Big firms: $15K/mo minimums. We start at $625/mo with flexible terms.",
  },
};

const complexityRatings = {
  extensions: { rating: 4, factors: ["C# development", "P21 Extensions SDK", "Testing cycles", "Regression risk"] },
  integrations: { rating: 3, factors: ["API documentation", "Rate limiting", "Error handling", "OAuth complexity"] },
  database: { rating: 2, factors: ["SQL proficiency", "Index design", "Query optimization", "Minimal deployment risk"] },
  warehouse: { rating: 3, factors: ["Workflow analysis", "Configuration logic", "User training", "Process change management"] },
  portals: { rating: 4, factors: ["Full-stack development", "Authentication", "API integration", "Responsive design"] },
  support: { rating: 1, factors: ["Ongoing relationship", "Ad-hoc tasks", "Low risk", "Flexible scope"] },
};

const techStacks = {
  extensions: ["P21 Extensions SDK (C# .NET 4.7.2+)", "Visual Studio 2019/2022", "SQL Server 2016+ (custom tables)", "P21 Transaction API v2", "DynaChange Business Rules Engine"],
  integrations: ["N8N Automation Platform", "PostgreSQL (workflow state)", "REST APIs (OAuth2 + JWT)", "Rate Limiting Middleware", "Error Logging & Monitoring"],
  database: ["SQL Server 2016-2022", "Execution Plan Analyzer", "Covering Index Design", "Keyset Pagination Patterns", "Crystal Reports / SSRS"],
  warehouse: ["SQL Server Triggers", "N8N Workflow Engine (optional)", "P21 DynaChange Rules", "Custom Config Tables", "ShipLink / UPS WorldShip APIs"],
  portals: ["HTML5 / CSS3 / JavaScript", "P21 GetItemPrice API", "P21 Transaction API v2", "OAuth2 / Token Auth", "SSL/TLS Encryption"],
  support: ["Remote Desktop / VPN", "SQL Server Mgmt Studio", "Visual Studio Code", "N8N / Automation Studio", "Ticketing System (Freshdesk/Desk365)"],
};

const timelines = {
  extensions: [
    { phase: "Discovery & Requirements", duration: "2-3 days", deliverable: "Technical spec with SDK patterns" },
    { phase: "Development & Testing", duration: "5-12 days", deliverable: "Compiled .DLL with source code" },
    { phase: "UAT & Deployment", duration: "2-3 days", deliverable: "Production deployment + documentation" },
    { phase: "Warranty Period", duration: "30 days", deliverable: "Bug fixes & adjustments included" },
  ],
  integrations: [
    { phase: "API Discovery", duration: "1-2 days", deliverable: "Integration architecture diagram" },
    { phase: "Workflow Development", duration: "5-10 days", deliverable: "N8N workflows with error handling" },
    { phase: "Testing & Validation", duration: "2-4 days", deliverable: "Test results with performance metrics" },
    { phase: "Go-Live Support", duration: "30 days", deliverable: "Monitoring + adjustments" },
  ],
  database: [
    { phase: "Performance Audit", duration: "1 day", deliverable: "Top 10 slow queries identified" },
    { phase: "Query Optimization", duration: "1-2 days", deliverable: "Rewritten queries + indexes" },
    { phase: "Testing & Benchmarking", duration: "1 day", deliverable: "Before/after performance metrics" },
    { phase: "Warranty Period", duration: "90 days", deliverable: "Performance guarantee" },
  ],
  warehouse: [
    { phase: "Workflow Analysis", duration: "2-3 days", deliverable: "Current-state process map" },
    { phase: "Configuration Development", duration: "3-8 days", deliverable: "Automation rules + config portal" },
    { phase: "Pilot Testing", duration: "2-4 days", deliverable: "Real-world validation with metrics" },
    { phase: "Rollout & Training", duration: "1-2 days", deliverable: "Full deployment + user training" },
  ],
  portals: [
    { phase: "Requirements & Design", duration: "3-5 days", deliverable: "UI mockups + feature spec" },
    { phase: "Development", duration: "8-14 days", deliverable: "Functional portal with API integration" },
    { phase: "Testing & QA", duration: "2-3 days", deliverable: "Browser/device compatibility validated" },
    { phase: "Training & Warranty", duration: "60 days", deliverable: "User training + support" },
  ],
  support: [
    { phase: "Onboarding", duration: "1 week", deliverable: "System access + relationship setup" },
    { phase: "Ongoing Support", duration: "Monthly", deliverable: "Guaranteed hours + response SLA" },
    { phase: "Quarterly Review", duration: "Varies", deliverable: "System health check + optimization" },
  ],
};

const riskProfiles = {
  extensions: {
    low: ["Business logic errors (testing catches 95%)"],
    medium: ["Performance impact on high-volume operations", "Multi-user concurrency edge cases"],
    high: ["P21 version upgrade compatibility (mitigated by SDK patterns)"],
    mitigation: "Test in PLAY environment. Deploy to production during low-volume hours. 30-day warranty covers defects.",
  },
  integrations: {
    low: ["Rate limit violations (handled by retry logic)"],
    medium: ["API endpoint changes (vendor-dependent)", "OAuth token expiration (auto-refresh built-in)"],
    high: ["Data sync failures during P21 downtime"],
    mitigation: "Queue-based architecture with error recovery. Email alerts for failures. 30-day support for tuning.",
  },
  database: {
    low: ["Query syntax errors (pre-tested)"],
    medium: ["Index bloat over time (monitoring recommended)"],
    high: ["Rare regression on untested query patterns"],
    mitigation: "90-day performance warranty. Before/after benchmarks documented. Rollback scripts provided.",
  },
  warehouse: {
    low: ["Configuration errors (admin portal prevents bad data)"],
    medium: ["User training gap (addressed with hands-on session)", "Edge case routing logic"],
    high: ["Process change resistance"],
    mitigation: "Pilot deployment phase validates logic. User training included. 60-day warranty for adjustments.",
  },
  portals: {
    low: ["Browser compatibility issues (tested Chrome/Edge/Safari)"],
    medium: ["API performance under load (batch optimization included)", "User credential management"],
    high: ["Security vulnerabilities (SSL + token auth required)"],
    mitigation: "Security audit included. SSL certificate setup. Rate limiting on API calls. 60-day warranty.",
  },
  support: {
    low: ["Response time SLA miss (track record: 99.2% SLA compliance)"],
    medium: ["Scope creep beyond included hours"],
    high: ["Knowledge transfer dependency (single consultant)"],
    mitigation: "Transparent hourly tracking. Overage approval required. Documentation for all work performed.",
  },
};

const beforeAfter = {
  extensions: {
    before: { metric: "Manual intervention required", value: "200 orders/mo", pain: "15 min each, error-prone" },
    after: { metric: "Automated validation", value: "100% orders", gain: "Zero manual intervention, instant feedback" },
  },
  integrations: {
    before: { metric: "Manual data entry", value: "20 hrs/wk", pain: "12 errors/mo, constant re-keying" },
    after: { metric: "Automated sync", value: "Every 30 min", gain: "Zero manual entry, 99.9% accuracy" },
  },
  database: {
    before: { metric: "Report load time", value: "30+ sec", pain: "Staff waiting, timeouts on large datasets" },
    after: { metric: "Optimized queries", value: "<2 sec", gain: "10-15x faster, no timeouts" },
  },
  warehouse: {
    before: { metric: "Picker travel time", value: "100% baseline", pain: "Inefficient bin routing, shipping errors" },
    after: { metric: "Optimized routing", value: "75% of baseline", gain: "25% time savings, zero carrier errors" },
  },
  portals: {
    before: { metric: "CSR pricing lookup", value: "4 min/quote", pain: "Slow P21 UI, manual navigation" },
    after: { metric: "Self-service portal", value: "30 sec/quote", gain: "8x faster, CSR time freed for sales" },
  },
  support: {
    before: { metric: "Emergency support cost", value: "$300/hr", pain: "Unpredictable bills, vendor roulette" },
    after: { metric: "Retainer pricing", value: "$110-125/hr", gain: "Predictable monthly cost, priority access" },
  },
};

const competitiveAdvantages = {
  extensions: [
    "Real production experience: We deploy business rules weekly in a live P21 environment",
    "Fail-safe patterns: Rules never block legitimate operations (learned from costly mistakes)",
    "Multi-version support: Desktop + Web UI compatibility from day one",
    "75% cost savings vs. Epicor's $250/hr consulting rates",
  ],
  integrations: [
    "Proven performance: 150x speed improvements, 140x API call reductions in production",
    "Self-hosted N8N: One-time cost vs. $1,200-$3,000/mo for Zapier Enterprise / Workato",
    "Rate limiting expertise: Avoid vendor API throttling (learned through trial by fire)",
    "Open-source stack: No vendor lock-in, full workflow portability",
  ],
  database: [
    "Query optimization over hardware: 90% cost savings vs. $10K+ server upgrades",
    "Real-world SQL patterns: Covering indexes, keyset pagination, execution plan tuning",
    "Crystal Reports specialization: Deep knowledge of P21's reporting quirks",
    "90-day performance warranty: We stand behind the work",
  ],
  warehouse: [
    "95% cost savings vs. full WMS implementations ($50K-$250K budgets)",
    "Configuration-driven: Warehouse managers control logic without code changes",
    "Faster ROI: 2-4 months vs. 12-24 months for traditional WMS",
    "P21-native: No middleware, no separate system to maintain",
  ],
  portals: [
    "Customer UX focus: Modern web UI vs. clunky P21 WebPOS",
    "Batch API optimization: Handle 280K+ product catalogs without timeouts",
    "Mobile-responsive: Glassmorphism design works on any device",
    "Competitive differentiation: Give customers a reason to choose you over Amazon",
  ],
  support: [
    "Affordable: Start at $625/mo vs. $15K/mo enterprise firms",
    "Real P21 operator: We use the system daily, not just consult on it",
    "Transparent pricing: Hourly tracking, overage approval required",
    "99.2% SLA compliance: Proven track record on response times",
  ],
};

type ServiceId = 'extensions' | 'integrations' | 'database' | 'warehouse' | 'portals' | 'support';

const serializedServices = services.items.map(service => ({
  ...service,
  enhancements: {
    roiModel: roiModels[service.id as ServiceId],
    complexity: complexityRatings[service.id as ServiceId],
    techStack: techStacks[service.id as ServiceId],
    timeline: timelines[service.id as ServiceId],
    risks: riskProfiles[service.id as ServiceId],
    comparison: beforeAfter[service.id as ServiceId],
    advantages: competitiveAdvantages[service.id as ServiceId],
  },
}));

const retainerTiers = [
  {
    name: "Basic",
    price: "$625",
    period: "/mo",
    hours: "5 hrs",
    highlight: false,
    features: [
      { text: "5 hours of support", included: true },
      { text: "Email support", included: true },
      { text: "48-hour response time", included: true },
      { text: "Quarterly check-in", included: true },
      { text: "Minor fixes & troubleshooting", included: true },
      { text: "Priority response", included: false },
      { text: "Proactive monitoring", included: false },
      { text: "Dedicated availability", included: false },
    ],
  },
  {
    name: "Standard",
    price: "$1,100",
    period: "/mo",
    hours: "10 hrs",
    highlight: true,
    features: [
      { text: "10 hours of support", included: true },
      { text: "Email & phone support", included: true },
      { text: "24-hour response time", included: true },
      { text: "Monthly system review", included: true },
      { text: "Business rules maintenance", included: true },
      { text: "Priority response", included: true },
      { text: "Proactive monitoring", included: false },
      { text: "Dedicated availability", included: false },
    ],
  },
  {
    name: "Premium",
    price: "$2,000",
    period: "/mo",
    hours: "20 hrs",
    highlight: false,
    features: [
      { text: "20 hours of support", included: true },
      { text: "Email, phone & video support", included: true },
      { text: "Same-day response", included: true },
      { text: "Weekly touchpoint", included: true },
      { text: "Business rules maintenance", included: true },
      { text: "Priority response", included: true },
      { text: "Proactive monitoring", included: true },
      { text: "Dedicated availability", included: false },
    ],
  },
  {
    name: "Dedicated",
    price: "$3,600",
    period: "/mo",
    hours: "40 hrs",
    highlight: false,
    features: [
      { text: "40 hours of support", included: true },
      { text: "Email, phone & video support", included: true },
      { text: "Same-day response", included: true },
      { text: "Weekly touchpoint", included: true },
      { text: "Business rules maintenance", included: true },
      { text: "Priority response", included: true },
      { text: "Proactive monitoring", included: true },
      { text: "Dedicated availability", included: true },
    ],
  },
];
---

<BaseLayout
  title="Services"
  description={description}
  schemaType="services"
>

  <!-- HERO: ROI Calculator in Hero Position -->
  <Section background="base" padding="sm" class="pt-28 md:pt-32 pb-8 md:pb-12 relative overflow-hidden">
    <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
      <div class="absolute top-0 right-0 w-[500px] h-[500px] bg-accent-primary/5 rounded-full blur-[120px] -translate-y-1/2 translate-x-1/4"></div>
      <div class="absolute bottom-0 left-0 w-[400px] h-[400px] bg-accent-violet/5 rounded-full blur-[100px] translate-y-1/2 -translate-x-1/4"></div>
    </div>

    <Container class="relative">
      <div class="max-w-3xl mx-auto text-center mb-10 scroll-reveal">
        <TextReveal
          text={services.hero.headline}
          as="h1"
          className="text-[length:var(--font-size-hero)] font-bold leading-[1.1] text-text-primary mb-4"
          client:visible
        />
        <p class="text-[length:var(--font-size-body-lg)] text-text-secondary max-w-2xl mx-auto leading-relaxed">
          {services.hero.subheadline}
        </p>
      </div>

      <!-- Trust Metrics -->
      <div class="grid grid-cols-3 gap-3 sm:gap-6 max-w-xl mx-auto mb-10 scroll-reveal" style="animation-delay: 100ms;">
        <div class="text-center">
          <ScrollCounter value="150x" className="text-2xl sm:text-3xl md:text-4xl font-mono font-bold text-accent-primary" client:visible />
          <p class="text-[10px] sm:text-xs text-text-tertiary mt-1">Performance Boost</p>
        </div>
        <div class="text-center">
          <ScrollCounter value="280K" className="text-2xl sm:text-3xl md:text-4xl font-mono font-bold text-accent-primary" client:visible />
          <p class="text-[10px] sm:text-xs text-text-tertiary mt-1">Products Synced</p>
        </div>
        <div class="text-center">
          <ScrollCounter value="140x" className="text-2xl sm:text-3xl md:text-4xl font-mono font-bold text-accent-primary" client:visible />
          <p class="text-[10px] sm:text-xs text-text-tertiary mt-1">Fewer API Calls</p>
        </div>
      </div>

      <!-- ROI Calculator -->
      <div class="max-w-5xl mx-auto scroll-reveal" style="animation-delay: 200ms;">
        <InteractiveROICalculator client:visible />
      </div>

      <div class="text-center mt-4 scroll-reveal" style="animation-delay: 300ms;">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-text-tertiary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto opacity-40 animate-bounce"><path d="m6 9 6 6 6-6"/></svg>
      </div>
    </Container>
  </Section>

  <!-- TRANSPARENCY DIFFERENTIATOR -->
  <Section background="surface-1" padding="lg" class="relative overflow-hidden">
    <!-- Decorative glow -->
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[400px] bg-accent-success/5 rounded-full blur-[150px] pointer-events-none" aria-hidden="true"></div>

    <Container class="relative">
      <!-- Badge + Headline -->
      <div class="text-center mb-12 scroll-reveal">
        <Badge variant="success" class="mb-5">
          <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
          </svg>
          {services.transparency.badge}
        </Badge>
        <h2 class="text-[length:var(--font-size-h2)] md:text-4xl lg:text-5xl font-bold text-text-primary leading-tight mb-4">
          {services.transparency.headline}
        </h2>
        <p class="text-[length:var(--font-size-body-lg)] text-text-secondary max-w-2xl mx-auto leading-relaxed">
          {services.transparency.subheadline}
        </p>
      </div>

      <!-- Comparison: Them vs Us -->
      <div class="max-w-3xl mx-auto mb-14 scroll-reveal" style="animation-delay: 100ms;">
        <div class="grid grid-cols-2 gap-0 rounded-xl overflow-hidden border border-border">
          <!-- Header row -->
          <div class="bg-accent-error/10 px-4 py-3 sm:px-6 sm:py-4 border-b border-border">
            <p class="text-sm font-semibold text-accent-error uppercase tracking-wider">Other Consultants</p>
          </div>
          <div class="bg-accent-success/10 px-4 py-3 sm:px-6 sm:py-4 border-b border-border">
            <p class="text-sm font-semibold uppercase tracking-wider"><span class="text-accent-success">LUMINA</span> <span class="text-accent-primary">ERP</span></p>
          </div>
          <!-- Comparison rows -->
          {services.transparency.comparisonItems.map((item, index) => (
            <>
              <div class:list={["px-4 py-3 sm:px-6 sm:py-4 flex items-center gap-2 bg-bg-surface-2/50", index < services.transparency.comparisonItems.length - 1 ? "border-b border-border/50" : ""]}>
                <svg class="w-4 h-4 text-accent-error/60 shrink-0 hidden sm:block" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <circle cx="12" cy="12" r="10" /><path d="M8 12h8" />
                </svg>
                <span class="text-sm text-text-tertiary italic">{item.them}</span>
              </div>
              <div class:list={["px-4 py-3 sm:px-6 sm:py-4 flex items-center gap-2 bg-accent-success/[0.03]", index < services.transparency.comparisonItems.length - 1 ? "border-b border-border/50" : ""]}>
                <svg class="w-4 h-4 text-accent-success shrink-0 hidden sm:block" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <path d="M20 6 9 17l-5-5" />
                </svg>
                <span class="text-sm text-text-primary font-medium">{item.us}</span>
              </div>
            </>
          ))}
        </div>
      </div>

      <!-- Trust Signal Cards -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-14 scroll-reveal" style="animation-delay: 200ms;">
        {services.transparency.trustSignals.map((signal) => (
          <div class="text-center p-5 rounded-xl bg-bg-surface-2/50 border border-border/50 hover:border-accent-primary/30 transition-colors duration-normal">
            <div class="w-10 h-10 mx-auto mb-3 rounded-lg bg-accent-primary/10 flex items-center justify-center">
              {signal.icon === "lock" && (
                <svg class="w-5 h-5 text-accent-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" />
                </svg>
              )}
              {signal.icon === "calendar" && (
                <svg class="w-5 h-5 text-accent-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" />
                </svg>
              )}
              {signal.icon === "shield" && (
                <svg class="w-5 h-5 text-accent-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                </svg>
              )}
              {signal.icon === "refresh" && (
                <svg class="w-5 h-5 text-accent-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2" />
                </svg>
              )}
            </div>
            <h4 class="text-sm font-semibold text-text-primary mb-1">{signal.label}</h4>
            <p class="text-xs text-text-tertiary leading-relaxed">{signal.detail}</p>
          </div>
        ))}
      </div>

      <!-- Pull Quote -->
      <div class="max-w-2xl mx-auto text-center scroll-reveal" style="animation-delay: 300ms;">
        <blockquote class="relative">
          <svg class="w-8 h-8 text-accent-primary/20 mx-auto mb-3" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.731-9.57 8.983-10.609l.998 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.986z" />
          </svg>
          <p class="text-lg md:text-xl text-text-primary font-medium italic leading-relaxed">
            {services.transparency.pullQuote}
          </p>
        </blockquote>
      </div>
    </Container>
  </Section>

  <!-- SERVICE SELECTOR QUIZ -->
  <Section id="service-quiz" background="base" padding="sm" class="py-8">
    <Container>
      <div class="min-h-[200px]">
        <ServiceSelectorQuiz client:visible className="max-w-3xl mx-auto" />
      </div>
    </Container>
  </Section>

  <!-- STICKY ANCHOR NAV -->
  <div class="sticky top-16 z-30 bg-bg-base/90 backdrop-blur-lg border-b border-border/50">
    <Container>
      <nav class="flex items-center gap-2 py-3 overflow-x-auto scrollbar-none" aria-label="Service sections">
        {services.anchors.map((anchor) => (
          <a
            href={anchor.href}
            class="anchor-link shrink-0 px-4 py-2 text-sm font-medium rounded-full text-text-secondary hover:text-text-primary hover:bg-bg-surface-2 transition-colors duration-fast no-underline"
          >
            {anchor.label}
          </a>
        ))}
      </nav>
    </Container>
  </div>

  <!-- SERVICE CARDS GRID (Progressive Disclosure) -->
  <Section background="base" padding="md">
    <Container>
      <div class="text-center mb-10 scroll-reveal">
        <h2 class="text-[length:var(--font-size-h2)] font-bold text-text-primary leading-tight mb-4">
          Our Services â€” With Published Pricing
        </h2>
        <p class="text-[length:var(--font-size-body-lg)] text-text-secondary max-w-2xl mx-auto">
          Every service includes upfront pricing, timelines, and deliverables. Click any card to explore ROI models, tech stack, and implementation details.
        </p>
      </div>

      <div class="min-h-[400px]">
        <ServiceCardGrid
          client:visible
          services={serializedServices}
        />
      </div>
    </Container>
  </Section>

  <!-- CLOUD MIGRATION SPOTLIGHT -->
  <Section id="migration" background="surface-1" padding="lg" class="relative overflow-hidden">
    <div class="absolute top-0 right-0 w-96 h-96 bg-accent-primary/5 rounded-full blur-3xl pointer-events-none"></div>
    <div class="absolute bottom-0 left-0 w-64 h-64 bg-accent-violet/5 rounded-full blur-3xl pointer-events-none"></div>

    <Container class="relative">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
        <div class="scroll-reveal">
          <Badge variant="warning" class="mb-6">
            <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" />
            </svg>
            Time-Sensitive
          </Badge>

          <h2 class="text-[length:var(--font-size-h2)] font-bold text-text-primary leading-tight mb-6">
            The P21 Cloud Migration<br />
            <span class="text-accent-primary">Deadline Is Real</span>
          </h2>

          <p class="text-[length:var(--font-size-body-lg)] text-text-secondary leading-relaxed mb-8">
            Epicor is ending on-premises P21. This isn't a rumor -- it's a published timeline. Every distributor running P21 on-prem needs a migration plan, and the window to prepare is narrowing.
          </p>

          <div class="space-y-6">
            <div class="flex gap-4">
              <div class="shrink-0 w-16 text-right">
                <span class="text-sm font-mono font-bold text-accent-warning">May 2026</span>
              </div>
              <div class="grow border-l-2 border-accent-warning/30 pl-4 pb-6">
                <h4 class="font-semibold text-text-primary mb-1">Classic UI Retirement</h4>
                <p class="text-sm text-text-secondary">Kinetic 2026.1 discontinues the Classic UI. Browser-based interface becomes mandatory.</p>
              </div>
            </div>
            <div class="flex gap-4">
              <div class="shrink-0 w-16 text-right">
                <span class="text-sm font-mono font-bold text-accent-warning">May 2028</span>
              </div>
              <div class="grow border-l-2 border-accent-warning/30 pl-4 pb-6">
                <h4 class="font-semibold text-text-primary mb-1">Final On-Prem Release</h4>
                <p class="text-sm text-text-secondary">P21 2028.1 is the last on-premises feature release. No new functionality after this.</p>
              </div>
            </div>
            <div class="flex gap-4">
              <div class="shrink-0 w-16 text-right">
                <span class="text-sm font-mono font-bold text-accent-error">Jun 2029</span>
              </div>
              <div class="grow border-l-2 border-accent-error/30 pl-4">
                <h4 class="font-semibold text-text-primary mb-1">Active Support Ends</h4>
                <p class="text-sm text-text-secondary">On-premises P21 loses active support. All customers must be on cloud.</p>
              </div>
            </div>
          </div>
        </div>

        <div class="scroll-reveal" style="animation-delay: 150ms;">
          <Card hover={false} padding="lg">
            <h3 class="text-xl font-semibold text-text-primary mb-6">What We Deliver for Migration</h3>
            <div class="space-y-5">
              {[
                { num: "1", title: "Customization Audit", desc: "Complete inventory of every business rule, report, and integration with cloud compatibility assessment." },
                { num: "2", title: "Migration Roadmap", desc: "Detailed timeline with milestones, risk assessment, and resource requirements specific to your environment." },
                { num: "3", title: "Remediation & Testing", desc: "Fix incompatible business rules, rebuild reports for cloud, and validate data integrity before go-live." },
                { num: "4", title: "Training & Go-Live", desc: "Role-based training for your team on the Kinetic UI, plus hands-on support through the transition." },
              ].map((step) => (
                <div class="flex items-start gap-3">
                  <div class="w-8 h-8 flex items-center justify-center rounded-lg bg-accent-primary/10 shrink-0">
                    <span class="text-sm font-mono font-bold text-accent-primary">{step.num}</span>
                  </div>
                  <div>
                    <h4 class="font-semibold text-text-primary text-sm">{step.title}</h4>
                    <p class="text-sm text-text-secondary mt-1 leading-relaxed">{step.desc}</p>
                  </div>
                </div>
              ))}
            </div>
            <div class="mt-8 pt-6 border-t border-border">
              <div class="flex items-center justify-between mb-4">
                <span class="text-sm text-text-tertiary">Migration projects start at</span>
                <span class="text-2xl font-mono font-bold text-accent-primary">$5,000</span>
              </div>
              <Button href="/contact" variant="primary" size="md" arrow class="w-full">
                Get a Migration Assessment
              </Button>
            </div>
          </Card>
        </div>
      </div>
    </Container>
  </Section>

  <!-- RETAINER PRICING TIERS -->
  <Section background="base" padding="lg" class="relative overflow-hidden">
    <!-- Subtle glow behind pricing -->
    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[600px] h-[300px] bg-accent-primary/5 rounded-full blur-[120px] pointer-events-none" aria-hidden="true"></div>

    <Container class="relative">
      <div class="text-center mb-6 scroll-reveal">
        <Badge variant="success" class="mb-4">
          <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83" />
          </svg>
          Transparent Pricing
        </Badge>
        <h2 class="text-[length:var(--font-size-h2)] font-bold text-text-primary leading-tight mb-4">Ongoing Support Plans</h2>
        <p class="text-[length:var(--font-size-body-lg)] text-text-secondary max-w-2xl mx-auto">
          Predictable monthly support with guaranteed response times. Flexible plans that scale with your needs.
        </p>
      </div>

      <!-- Promise bar -->
      <div class="flex flex-wrap items-center justify-center gap-4 sm:gap-8 mb-14 scroll-reveal" style="animation-delay: 50ms;">
        <div class="flex items-center gap-2 text-sm text-text-secondary">
          <svg class="w-4 h-4 text-accent-success" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M20 6 9 17l-5-5" /></svg>
          Flexible plans
        </div>
        <div class="flex items-center gap-2 text-sm text-text-secondary">
          <svg class="w-4 h-4 text-accent-success" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M20 6 9 17l-5-5" /></svg>
          Scale up or down anytime
        </div>
        <div class="flex items-center gap-2 text-sm text-text-secondary">
          <svg class="w-4 h-4 text-accent-success" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M20 6 9 17l-5-5" /></svg>
          Overage requires your approval
        </div>
        <div class="flex items-center gap-2 text-sm text-text-secondary">
          <svg class="w-4 h-4 text-accent-success" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M20 6 9 17l-5-5" /></svg>
          Transparent hourly tracking
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 lg:gap-8">
        {retainerTiers.map((tier) => (
          <div
            class:list={[
              "relative bg-bg-surface-1 rounded-xl p-6 sm:p-8 border transition-all duration-normal scroll-reveal",
              tier.highlight
                ? "border-accent-primary shadow-glow md:scale-[1.02]"
                : "border-border hover:border-accent-primary/50",
            ]}
          >
            {tier.highlight && (
              <div class="absolute -top-3 left-1/2 -translate-x-1/2">
                <Badge variant="primary">Most Popular</Badge>
              </div>
            )}
            <div class="text-center mb-8">
              <h3 class="text-lg font-semibold text-text-primary mb-2">{tier.name}</h3>
              <div class="flex items-baseline justify-center gap-1">
                <span class="text-[length:var(--font-size-metric)] font-mono font-bold text-accent-primary">{tier.price}</span>
                <span class="text-text-secondary">{tier.period}</span>
              </div>
              <p class="text-sm text-text-tertiary mt-2">{tier.hours} included</p>
            </div>
            <div class="space-y-3 mb-8">
              {tier.features.map((feature) => (
                <div class="flex items-center gap-3">
                  {feature.included ? (
                    <svg class="w-5 h-5 text-accent-success shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                      <path d="M20 6 9 17l-5-5" />
                    </svg>
                  ) : (
                    <svg class="w-5 h-5 text-text-disabled shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                      <path d="M18 6 6 18M6 6l12 12" />
                    </svg>
                  )}
                  <span class:list={["text-sm", feature.included ? "text-text-secondary" : "text-text-disabled"]}>
                    {feature.text}
                  </span>
                </div>
              ))}
            </div>
            <Button href="/contact" variant={tier.highlight ? "primary" : "outline"} size="md" class="w-full">
              Get Started
            </Button>
          </div>
        ))}
      </div>

      <!-- What's NOT included - for extra transparency -->
      <div class="mt-12 max-w-2xl mx-auto scroll-reveal">
        <div class="bg-bg-surface-2/50 rounded-xl border border-border/50 p-6">
          <h4 class="text-sm font-semibold text-text-primary mb-4 flex items-center gap-2">
            <svg class="w-4 h-4 text-text-tertiary" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="12" /><line x1="12" y1="16" x2="12.01" y2="16" /></svg>
            What's Not Included (Because We Believe in Full Disclosure)
          </h4>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-2">
            <div class="flex items-center gap-2 text-sm text-text-tertiary">
              <span class="text-text-disabled">--</span> Third-party software licenses
            </div>
            <div class="flex items-center gap-2 text-sm text-text-tertiary">
              <span class="text-text-disabled">--</span> Server or hosting infrastructure
            </div>
            <div class="flex items-center gap-2 text-sm text-text-tertiary">
              <span class="text-text-disabled">--</span> Epicor license or subscription fees
            </div>
            <div class="flex items-center gap-2 text-sm text-text-tertiary">
              <span class="text-text-disabled">--</span> On-site travel (billed separately if needed)
            </div>
          </div>
          <p class="text-xs text-text-disabled mt-4">Hours beyond your plan require written approval before we begin. No surprise invoices.</p>
        </div>
      </div>

      <p class="text-center text-sm text-text-tertiary mt-8">
        All plans include 5-25% hourly discount vs. standard rates. Need something custom? <a href="/contact" class="text-accent-primary hover:underline no-underline">Let's talk.</a>
      </p>
    </Container>
  </Section>

  <!-- PROCESS STEPS -->
  <Section background="surface-1" padding="md">
    <Container>
      <div class="text-center mb-16 scroll-reveal">
        <Badge variant="primary" class="mb-4">
          <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" /><polyline points="14 2 14 8 20 8" /><line x1="16" y1="13" x2="8" y2="13" /><line x1="16" y1="17" x2="8" y2="17" /><polyline points="10 9 9 9 8 9" />
          </svg>
          No Surprises
        </Badge>
        <h2 class="text-[length:var(--font-size-h2)] font-bold text-text-primary leading-tight mb-4">{services.process.heading}</h2>
        <p class="text-[length:var(--font-size-body-lg)] text-text-secondary max-w-2xl mx-auto">
          You know what it costs before we start. You know what you're getting before we build. And you see progress every step of the way.
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {services.process.steps.map((step, index) => (
          <div class="relative scroll-reveal" style={`animation-delay: ${index * 100}ms;`}>
            {index < services.process.steps.length - 1 && (
              <div class="hidden lg:block absolute top-8 left-full w-6 border-t-2 border-dashed border-border z-10"></div>
            )}
            <Card hover={false}>
              <span class="text-3xl font-mono font-bold text-accent-primary/30 block mb-3">{step.number}</span>
              <h3 class="text-lg font-semibold text-text-primary mb-2">{step.title}</h3>
              <p class="text-sm text-text-secondary leading-relaxed">{step.description}</p>
            </Card>
          </div>
        ))}
      </div>
    </Container>
  </Section>

  <!-- BOTTOM CTA -->
  <Section background="gradient" padding="lg">
    <Container class="text-center">
      <h2 class="text-[length:var(--font-size-h2)] font-bold text-text-primary leading-tight mb-4">
        {services.bottomCta.heading}
      </h2>
      <p class="text-[length:var(--font-size-body-lg)] text-text-secondary max-w-xl mx-auto mb-10">
        {services.bottomCta.subheadline}
      </p>
      <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
        <Button href={services.bottomCta.cta.href} variant="primary" size="lg" arrow glow>
          {services.bottomCta.cta.label}
        </Button>
        <span class="text-text-secondary text-sm">
          or email <a href={`mailto:${brand.email}`} class="text-accent-primary hover:underline no-underline">{brand.email}</a>
        </span>
      </div>
    </Container>
  </Section>

</BaseLayout>

<style>
  .anchor-active {
    background-color: var(--color-accent-primary);
    color: white;
  }
  .scrollbar-none {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-none::-webkit-scrollbar {
    display: none;
  }
  /* Scroll offset for anchor links so sticky header + nav don't cover content */
  #extensions,
  #integrations,
  #database,
  #warehouse,
  #portals,
  #support,
  #migration,
  #service-quiz {
    scroll-margin-top: 8rem;
  }
</style>

<script>
  function initServices() {
    const anchors = document.querySelectorAll('.anchor-link');
    const sections = document.querySelectorAll('[id="extensions"], [id="integrations"], [id="database"], [id="warehouse"], [id="portals"], [id="support"]');

    if (anchors.length > 0 && sections.length > 0) {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              const id = entry.target.id;
              anchors.forEach((a) => {
                const link = a as HTMLAnchorElement;
                if (link.getAttribute('href') === `#${id}`) {
                  link.classList.add('anchor-active');
                } else {
                  link.classList.remove('anchor-active');
                }
              });
            }
          });
        },
        { threshold: 0.3, rootMargin: '-80px 0px -50% 0px' }
      );
      sections.forEach((section) => observer.observe(section));
    }
  }

  document.addEventListener('astro:page-load', initServices);
</script>

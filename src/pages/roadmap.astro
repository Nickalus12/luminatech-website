---
import BaseLayout from '../layouts/BaseLayout.astro';
import Section from '../components/ui/Section.astro';
import Container from '../components/ui/Container.astro';
import Badge from '../components/ui/Badge.astro';
import Button from '../components/ui/Button.astro';
import TextReveal from '../components/ui/TextReveal';
import RoadmapTimeline from '../components/ui/RoadmapTimeline';
import CodeConstruct from '../components/ui/CodeConstruct';
import AnimatedCounter from '../components/ui/AnimatedCounter';
import { roadmap } from '../content/copy';
---

<BaseLayout
  title="Roadmap"
  description="Explore Lumina ERP's strategic roadmap — four phases of growth from core P21 services to SaaS tools, community resources, and industry events."
  schemaType="about"
>

  <!-- ═══════════════════════════════════════════════════════════
       HERO — "Building the Future"
       ═══════════════════════════════════════════════════════════ -->
  <Section background="base" padding="sm" class="pt-28 md:pt-32 pb-12 md:pb-16 relative overflow-hidden">
    <!-- Floating gradient orbs -->
    <div class="floating-orb absolute -top-24 -right-32 w-[400px] h-[400px] bg-accent-primary/5 rounded-full blur-3xl pointer-events-none"></div>
    <div class="floating-orb-2 absolute -bottom-20 -left-28 w-[350px] h-[350px] bg-accent-violet/5 rounded-full blur-3xl pointer-events-none"></div>
    <div class="floating-orb-3 absolute top-32 left-1/4 w-[300px] h-[300px] bg-accent-success/5 rounded-full blur-3xl pointer-events-none"></div>

    <Container>
      <!-- Badge entrance -->
      <div class="hero-badge mb-6">
        <Badge variant="primary">{roadmap.hero.badge}</Badge>
      </div>

      <!-- Headline with word-by-word reveal -->
      <TextReveal
        text={roadmap.hero.headline}
        as="h1"
        className="text-[length:var(--font-size-hero)] font-bold leading-[1.1] text-text-primary mb-8"
        client:visible
      />

      <!-- Two-column: subtitle + stats | code construct -->
      <div class="flex flex-col lg:flex-row gap-10 lg:gap-16 items-start">
        <div class="flex-1 min-w-0">
          <p class="hero-subtitle text-lg text-text-secondary max-w-xl leading-relaxed mb-10">
            {roadmap.hero.subtitle}
          </p>

          <!-- Stats with counting animation -->
          <div class="hero-stats grid grid-cols-3 gap-4 max-w-md">
            {roadmap.hero.stats.map((stat) => (
              <div class="stat-card bg-bg-surface-1/50 backdrop-blur-sm border border-border/30 rounded-xl p-4 text-center">
                <AnimatedCounter
                  value={stat.value}
                  gradient
                  className="text-3xl md:text-4xl"
                  client:visible
                />
                <div class="text-xs text-text-tertiary mt-1 uppercase tracking-wider">{stat.label}</div>
              </div>
            ))}
          </div>
        </div>

        <!-- Code construct visual — brick-by-brick code editor (desktop) -->
        <div class="hidden lg:block w-full max-w-sm shrink-0">
          <CodeConstruct client:visible />
        </div>
      </div>
    </Container>
  </Section>

  <!-- ═══════════════════════════════════════════════════════════
       STICKY PHASE NAVIGATION
       ═══════════════════════════════════════════════════════════ -->
  <div class="sticky top-16 z-30 backdrop-blur-xl border-b border-border/30" style="background: rgba(10,10,15,0.85);">
    <Container>
      <nav class="flex gap-2 py-3 overflow-x-auto scrollbar-hide" role="tablist" aria-label="Roadmap phases">
        {roadmap.phases.map((phase) => (
          <a
            href={`#phase-${phase.id}`}
            role="tab"
            class:list={[
              'phase-nav-pill shrink-0 flex items-center gap-2.5 px-4 py-2.5 rounded-full text-sm font-medium border transition-all duration-300',
            ]}
            style={
              phase.status === 'completed'
                ? `border-color: ${phase.color}30; background: ${phase.color}08;`
                : phase.status === 'in-progress'
                  ? `border-color: ${phase.color}40; background: ${phase.color}10; box-shadow: 0 0 12px ${phase.color}15;`
                  : 'border-color: rgba(42,42,54,0.5); background: rgba(18,18,26,0.5);'
            }
          >
            {/* Phase dot */}
            {phase.status === 'completed' ? (
              <span class="w-2 h-2 rounded-full shrink-0" style={`background: ${phase.color};`}></span>
            ) : phase.status === 'in-progress' ? (
              <span class="relative shrink-0 w-2 h-2">
                <span class="absolute inset-0 rounded-full animate-ping opacity-40" style={`background: ${phase.color};`}></span>
                <span class="relative block w-2 h-2 rounded-full" style={`background: ${phase.color};`}></span>
              </span>
            ) : (
              <span class="w-2 h-2 rounded-full shrink-0 border border-text-tertiary/50"></span>
            )}

            {/* Phase info */}
            <span class="text-text-secondary whitespace-nowrap">
              <span class="font-mono text-xs text-text-tertiary mr-1">0{phase.id}</span>
              {phase.title}
            </span>

            {/* Timeframe (hidden on small) */}
            <span class="text-text-tertiary text-xs hidden sm:inline">{phase.timeframe}</span>

            {/* Completed check */}
            {phase.status === 'completed' && (
              <svg class="w-3.5 h-3.5" style={`color: ${phase.color};`} fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
              </svg>
            )}
          </a>
        ))}
      </nav>
    </Container>
  </div>

  <!-- ═══════════════════════════════════════════════════════════
       INTERACTIVE TIMELINE
       ═══════════════════════════════════════════════════════════ -->
  <Section background="base" padding="lg">
    <Container>
      <RoadmapTimeline phases={roadmap.phases} client:visible />
    </Container>
  </Section>

  <!-- ═══════════════════════════════════════════════════════════
       VISION STATEMENT
       ═══════════════════════════════════════════════════════════ -->
  <Section background="surface-1" padding="md">
    <Container>
      <div class="max-w-2xl mx-auto text-center relative section-reveal">
        <!-- Outer glow -->
        <div class="absolute inset-0 -m-8 bg-accent-primary/3 rounded-2xl blur-2xl pointer-events-none"></div>

        <!-- Animated gradient border wrapper -->
        <div class="vision-card-wrapper relative">
          <div class="vision-card-inner p-8 md:p-12">
            <h2 class="text-[length:var(--font-size-h2)] font-bold text-text-primary mb-4">
              {roadmap.vision.heading}
            </h2>
            <p class="text-lg text-text-secondary leading-relaxed">
              {roadmap.vision.body}
            </p>
          </div>
        </div>
      </div>
    </Container>
  </Section>

  <!-- ═══════════════════════════════════════════════════════════
       CTA
       ═══════════════════════════════════════════════════════════ -->
  <Section background="gradient" padding="lg">
    <Container>
      <div class="text-center max-w-2xl mx-auto relative section-reveal">
        <!-- Small floating orbs -->
        <div class="floating-orb absolute -top-16 -right-16 w-32 h-32 bg-accent-primary/5 rounded-full blur-2xl pointer-events-none"></div>
        <div class="floating-orb-2 absolute -bottom-12 -left-12 w-28 h-28 bg-accent-violet/5 rounded-full blur-2xl pointer-events-none"></div>

        <h2 class="text-[length:var(--font-size-h2)] font-bold text-text-primary mb-4">
          {roadmap.cta.heading}
        </h2>
        <p class="text-lg text-text-secondary mb-8">
          {roadmap.cta.subheading}
        </p>
        <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
          <Button href={roadmap.cta.buttonHref} arrow glow>{roadmap.cta.buttonLabel}</Button>
        </div>
        <p class="mt-6 text-text-tertiary text-sm">
          Or email us directly at <a href={`mailto:${roadmap.cta.email}`} class="text-accent-primary hover:underline">{roadmap.cta.email}</a>
        </p>
      </div>
    </Container>
  </Section>

</BaseLayout>

<!-- IntersectionObserver for scroll-triggered section reveals -->
<script>
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((e) => {
        if (e.isIntersecting) {
          e.target.classList.add('is-visible');
          observer.unobserve(e.target);
        }
      });
    },
    { threshold: 0.1, rootMargin: '-40px' }
  );
  document.querySelectorAll('.section-reveal').forEach((el) => observer.observe(el));
</script>

<style>
  /* ── Scrollbar hide for horizontal nav ────────────────── */
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  /* ── Floating orb ambient motion ───────────────────────── */
  @keyframes float-slow {
    0%, 100% { transform: translateY(0px) translateX(0px); }
    33% { transform: translateY(-20px) translateX(10px); }
    66% { transform: translateY(10px) translateX(-5px); }
  }
  .floating-orb { animation: float-slow 20s ease-in-out infinite; }
  .floating-orb-2 { animation: float-slow 25s ease-in-out infinite reverse; }
  .floating-orb-3 { animation: float-slow 18s ease-in-out infinite; animation-delay: -7s; }

  /* ── Hero entrance animations (staggered) ──────────────── */
  @keyframes hero-enter {
    from { opacity: 0; transform: translateY(50px) scale(0.96); }
    to { opacity: 1; transform: translateY(0) scale(1); }
  }
  .hero-badge {
    opacity: 0;
    animation: hero-enter 0.9s cubic-bezier(0.16, 1, 0.3, 1) 0.1s forwards;
  }
  .hero-subtitle {
    opacity: 0;
    animation: hero-enter 0.9s cubic-bezier(0.16, 1, 0.3, 1) 0.35s forwards;
  }
  .stat-card {
    opacity: 0;
    animation: hero-enter 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }
  .stat-card:nth-child(1) { animation-delay: 0.55s; }
  .stat-card:nth-child(2) { animation-delay: 0.65s; }
  .stat-card:nth-child(3) { animation-delay: 0.75s; }

  /* ── Phase nav pill staggered entrance ─────────────────── */
  @keyframes pill-enter {
    from { opacity: 0; transform: translateY(16px) scale(0.9); }
    to { opacity: 1; transform: translateY(0) scale(1); }
  }
  .phase-nav-pill {
    opacity: 0;
    animation: pill-enter 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }
  .phase-nav-pill:nth-child(1) { animation-delay: 0.1s; }
  .phase-nav-pill:nth-child(2) { animation-delay: 0.18s; }
  .phase-nav-pill:nth-child(3) { animation-delay: 0.26s; }
  .phase-nav-pill:nth-child(4) { animation-delay: 0.34s; }
  .phase-nav-pill:nth-child(5) { animation-delay: 0.42s; }
  .phase-nav-pill:hover {
    background: rgba(26,26,36,0.8) !important;
    border-color: rgba(59,130,246,0.3) !important;
  }

  /* ── Section reveal on scroll ──────────────────────────── */
  .section-reveal {
    opacity: 0;
    transform: translateY(80px) scale(0.94);
    transition: opacity 0.9s cubic-bezier(0.16, 1, 0.3, 1),
                transform 0.9s cubic-bezier(0.16, 1, 0.3, 1);
  }
  .section-reveal.is-visible {
    opacity: 1;
    transform: translateY(0) scale(1);
  }

  /* ── Vision card animated border ───────────────────────── */
  .vision-card-wrapper {
    position: relative;
    border-radius: 16px;
    padding: 1px;
    background: conic-gradient(from var(--border-angle, 0deg), rgba(59,130,246,0.3), rgba(139,92,246,0.3), rgba(59,130,246,0.1), rgba(139,92,246,0.3));
    animation: rotate-border 8s linear infinite;
  }
  .vision-card-inner {
    border-radius: 15px;
    background: rgba(18,18,26,0.9);
    backdrop-filter: blur(12px);
  }
  @property --border-angle {
    syntax: '<angle>';
    initial-value: 0deg;
    inherits: false;
  }
  @keyframes rotate-border {
    to { --border-angle: 360deg; }
  }

  /* ── Reduced motion — disable all animations ───────────── */
  @media (prefers-reduced-motion: reduce) {
    .floating-orb, .floating-orb-2, .floating-orb-3,
    .vision-card-wrapper {
      animation: none;
    }
    .hero-badge, .hero-subtitle, .stat-card, .phase-nav-pill {
      opacity: 1 !important;
      animation: none !important;
    }
    .section-reveal {
      opacity: 1 !important;
      transform: none !important;
      transition: none !important;
    }
  }
</style>

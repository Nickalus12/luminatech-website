---
import { ClientRouter } from 'astro:transitions';
import '../styles/global.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import SEO from '../components/SEO.astro';
import SchemaMarkup from '../components/SchemaMarkup.astro';
import Analytics from '../components/Analytics.astro';

interface Props {
  title: string;
  description: string;
  image?: string;
  article?: boolean;
  publishDate?: string;
  canonicalURL?: string;
  schemaType?: 'home' | 'about' | 'services' | 'contact' | 'blog-post';
  schemaPost?: {
    title: string;
    description: string;
    publishDate: string;
    image?: string;
    url: string;
  };
  schemaFaqs?: Array<{ question: string; answer: string }>;
}

const {
  title,
  description,
  image,
  article = false,
  publishDate,
  canonicalURL,
  schemaType,
  schemaPost,
  schemaFaqs,
} = Astro.props;
---

<!doctype html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#0A0A0F" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" href="/favicon.ico" sizes="32x32" />

    <SEO
      title={title}
      description={description}
      image={image}
      article={article}
      publishDate={publishDate}
      canonicalURL={canonicalURL}
    />

    {schemaType && (
      <SchemaMarkup
        type={schemaType}
        post={schemaPost}
        faqs={schemaFaqs}
      />
    )}

    <ClientRouter />
    <link rel="alternate" type="application/rss+xml" title="Lumina Erp Blog" href="/rss.xml" />
  </head>
  <body class="min-h-dvh flex flex-col bg-bg-base text-text-primary font-sans antialiased">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TGNXHWTC" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <a href="#main-content" class="skip-to-content">Skip to content</a>
    <Header />
    <main id="main-content" class="flex-1 pt-16">
      <slot />
    </main>
    <Footer />
    <Analytics />

    <script>
      function initScrollReveal() {
        const selectors = '.scroll-reveal, .scroll-reveal-left, .scroll-reveal-scale';
        const elements = document.querySelectorAll(selectors);

        if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
          elements.forEach((el) => el.classList.add('visible'));
          return;
        }

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                const el = entry.target as HTMLElement;
                const delay = el.style.animationDelay || '0ms';
                const ms = parseInt(delay, 10) || 0;
                setTimeout(() => el.classList.add('visible'), ms);
                observer.unobserve(el);
              }
            });
          },
          { threshold: 0.12, rootMargin: '0px 0px -50px 0px' }
        );

        elements.forEach((el) => observer.observe(el));
      }

      document.addEventListener('astro:page-load', initScrollReveal);
    </script>
  </body>
</html>
